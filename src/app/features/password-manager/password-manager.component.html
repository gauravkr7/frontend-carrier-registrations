<app-navbar (toggleSidebar)="toggleSidebar()"></app-navbar>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>




<main id="main" class=" bg-gray  main mt-0 p-0"
  [ngClass]="{'full-width': isSidebarOpen, 'shift-right': !isSidebarOpen}">
  <div class="p-4 pb-0">
    <h2 style="margin-left: 85px;" class="font-18 font-weight-700 mb-4 text-capitalize">Password List</h2>
    <div style="margin-left: 90px;" class="    bg-white rounded-lg p-3">
      <div class=" bg-styles  row bg-white px-3 mt-3 rounded">
        <div class="    col-md-12">


          <div class="tab-content" id="myTabContent ">
            <div class="tab-pane fade active show" id="customer" role="tabpanel" aria-labelledby="home-tab">
              <div id="kt_app_content" class="app-content  flex-column-fluid">
                <div class="my-4">
                  <div class="row">
                    <div class="col-md-12">

                      <div class="d-flex justify-content-between">
                        <div class="form-group has-search mb-0 d-flex">
                          <span class="fa fa-search form-control-feedback"></span>
                          <input style="height: 40px !important; padding-left: 30px;" type="text" name="Search"
                            class="form-control" placeholder="Search..." [(ngModel)]="searchQuery">
                          <button class="btn btn-success rounded-pill font-14 search-btn ms-3"
                            (click)="searchPasswords()">
                            <i class="bi bi-search"></i> Search
                          </button>
                        </div>

                        <div>
                          <a href="javascript:;" class="btn btn-success rounded-pill font-14" type="button"
                            data-bs-toggle="offcanvas" data-bs-target="#addPassword" aria-controls="offcanvasRight"> <i
                              class="fa fa-plus me-2" aria-hidden="true"></i> Add </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg-12">
                    <div class="table-responsive">
                      <table class="table table-bordered" style="text-align: left;">
                        <thead>
                          <tr>
                            <th scope="col">Company Name</th>
                            <th scope="col">Organization</th>
                            <th scope="col">Username</th>
                            <th scope="col">Password</th>
                            <th scope="col">Backup Phone Number</th>
                            <th scope="col" width="30px">Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let password of paginatedPasswords; let i = index">

                            <td>{{password.companyName }}</td>
                            <td>{{ password.organization }}</td>
                            <td>{{ password.username }}</td>
                            <td>{{ password.password }}</td>
                            <td>{{ password.backupPhoneNumber }}</td>


                            <td class="text-capitalize ">
                              <div class="dropdown filter-dropdown">
                                <span class="dropdown-toggle font-16 px-3" type="button" id="dropdownMenuButton23"
                                  data-bs-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-v"></i>
                                </span>
                                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
                                  <a href="javascript:;" class="dropdown-item assigned font-13"
                                    (click)="editPassword(password)" type="button" data-bs-toggle="offcanvas"
                                    data-bs-target="#ExtralargeModalEdit" aria-controls="offcanvasRight">Edit</a>
                                  <a class="dropdown-item assigned font-13" href="javascript:;" data-bs-toggle="modal"
                                    data-bs-target="#ExtralargeModalDelete"
                                    (click)="setPasswordToDelete(password._id)">Delete</a>
                                </div>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <div class="bg-white my-3 rounded pb-3 " style="margin-right: 90px;">
                        <div class="row">
                          <div class="col-md-12">
                            <nav aria-label="Page navigation example ms-auto me-auto">
                              <ul class="pagination justify-content-center gap-2 mb-0">
                                <li class="page-item" [class.disabled]="currentPage === 1">
                                  <a class="page-link font-22 d-flex align-items-center justify-content-center"
                                    href="javascript:;" aria-label="Previous" (click)="changePage(currentPage - 1)"><i
                                      class="fa fa-angle-left font-weight-300"></i></a>
                                </li>
                                <li class="page-item" *ngFor="let page of getPageNumbers()"
                                  [class.active]="currentPage === page">
                                  <a class="page-link font-14 d-flex align-items-center justify-content-center"
                                    href="javascript:;" (click)="changePage(page)">{{ page
                                    }}</a>
                                </li>
                                <li class="page-item" [class.disabled]="currentPage === getTotalPages()">
                                  <a class="page-link font-22 d-flex align-items-center justify-content-center"
                                    href="javascript:;" aria-label="Next" (click)="changePage(currentPage + 1)"><i
                                      class="fa fa-angle-right font-weight-300"></i></a>
                                </li>
                              </ul>
                            </nav>
                            <!-- Added: Showing entries info below pagination -->
                            <div class="text-center mt-2">
                              <ng-container *ngIf="paginatedPasswords.length > 0">
                                <span class="badge bg-light text-dark px-3 py-2" style="font-size: 14px; font-weight: normal;">
                                  Showing
                                  {{
                                    ((currentPage - 1) * itemsPerPage) + 1
                                  }}
                                  to
                                  {{
                                    ((currentPage - 1) * itemsPerPage) + paginatedPasswords.length
                                  }}
                                  of
                                  {{
                                    passwords.length
                                  }}
                                  entries (Page {{ currentPage }} of {{ getTotalPages() }})
                                </span>
                              </ng-container>
                              <ng-container *ngIf="paginatedPasswords.length === 0">
                                <span class="badge bg-light text-danger px-3 py-2" style="font-size: 14px;">
                                  No records to display.
                                </span>
                              </ng-container>
                            </div>
                            <!-- End added block -->
                          </div>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>






<!-- // special line add for edit -->
<div class="modal fade" id="ExtralargeModalDelete" tabindex="-1" style="display: none;" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <h2 class="my-5 text-center"><i class="fa fa-exclamation-triangle text-danger" style="font-size: 60px;"></i>
        </h2>
        <h3 class="font-18 font-weight-700 text-center">Are you sure you want to delete this password?</h3>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-success btn-sm text-uppercase rounded-pill px-3" data-bs-dismiss="modal"
          (click)="passwordIdToDelete && deletePassword(passwordIdToDelete)">Yes</button>
        <button type="button" class="btn btn-outline-secondary btn-sm text-uppercase rounded-pill px-3"
          data-bs-dismiss="modal">No</button>
      </div>
    </div>
  </div>
</div>
<a href="#" class="back-to-top d-flex align-items-center justify-content-center btn-success"><i
    class="bi bi-arrow-up-short"></i></a>


<div class="offcanvas offcanvas-end" tabindex="-1" id="addPassword" aria-labelledby="offcanvasRightLabel"
  style="width: 80%;" data-bs-backdrop="static">
  <div class="modal-header" style="padding: 15px; border-bottom: 1px solid #ccc;">
    <h5 class="modal-title">{{ isEditMode ? 'Edit Password' : 'Add Password' }}</h5>
    <div>

    </div>
  </div>
  <div class="offcanvas-body view-load position-relative">
    <form class="row g-3">
      <div class="col-md-6">
        <label for="company" class="form-label">Company</label>
        <select class="form-select" id="company" [(ngModel)]="selectedCompanyId" name="company" required>
          <option value="" disabled>Select a company</option>
          <option *ngFor="let company of companies" [value]="company._id">{{ company.companyName }}
          </option>
        </select>
        <div *ngIf="!selectedCompanyId" class="text-danger mt-1">
          Company selection is required.
        </div>
      </div>
      <div class="col-md-6">
        <h2 class="font-14 font-weight-700"> Organization</h2>
        <input type="text" class="form-control" [(ngModel)]="passwordForm.organization" name="organization" required>
      </div>
      <div class="col-md-6">
        <h2 class="font-14 font-weight-700">Username</h2>
        <input type="text" class="form-control" [(ngModel)]="passwordForm.username" name="username" required>
      </div>
      <div class="col-md-6">
        <h2 class="font-14 font-weight-700">Password</h2>
        <input type="text" class="form-control" [(ngModel)]="passwordForm.password" name="password" required>
      </div>
      <div class="col-md-6">
        <h2 class="font-14 font-weight-700">Backup Phone Number</h2>
        <input type="text" class="form-control" [(ngModel)]="passwordForm.backupPhoneNumber" name="backupPhoneNumber"
          required>
      </div>
      <div class="col-md-6">
        <h2 class="font-14 font-weight-700">Note</h2>
        <textarea class="form-control" [(ngModel)]="passwordForm.note" name="note" rows="3" required></textarea>
      </div>
      <hr class="hr">
    </form>

    <div class="modal-footer justify-content-center"
      style="border-top: 1px solid #ccc; padding-top: 15px; margin-top: 15px; ">
      <button type="button" class="btn btn-outline-secondary btn-sm text-uppercase rounded-pill"
        data-bs-dismiss="offcanvas" style="margin: 10px;">Close</button>
      <button type="submit" class="btn btn-success btn-sm text-uppercase rounded-pill" data-bs-dismiss="offcanvas"
        (click)="submitForm()">Submit Form</button>
    </div>
  </div>
</div>

<div class="offcanvas offcanvas-end" tabindex="-1" id="ExtralargeModalEdit" aria-labelledby="offcanvasRightLabel"
  style="width: 80%;">
  <div class="modal-header" style="padding: 15px; border-bottom: 1px solid #ccc;">
    <h5 class="modal-title">{{ isEditMode ? 'Edit Password' : 'Add Password' }}</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"
      (click)="resetForm()"></button>
  </div>
  <div class="offcanvas-body view-load position-relative">
    <form class="row g-3">
      <div class="col-md-6">
        <label for="company" class="form-label">Company</label>
        <select class="form-select" id="company" [(ngModel)]="selectedCompanyId" name="company" required>
          <option value="" disabled>Select a company</option>
          <option *ngFor="let company of companies" [value]="company._id">{{ company.companyName }}
          </option>
        </select>
        <div *ngIf="!selectedCompanyId" class="text-danger mt-1">
          Please select a company.
        </div>
      </div>
      <div class="col-md-6">
        <h2 class="font-14 font-weight-700"> Organization</h2>
        <input type="text" class="form-control" [(ngModel)]="passwordForm.organization" name="organization" required>
      </div>
      <div class="col-md-6">
        <h2 class="font-14 font-weight-700">Username</h2>
        <input type="text" class="form-control" [(ngModel)]="passwordForm.username" name="username" required>
      </div>
      <div class="col-md-6">
        <h2 class="font-14 font-weight-700">Password</h2>
        <input type="text" class="form-control" [(ngModel)]="passwordForm.password" name="password" required>
      </div>
      <div class="col-md-6">
        <h2 class="font-14 font-weight-700">Backup Phone Number</h2>
        <input type="text" class="form-control" [(ngModel)]="passwordForm.backupPhoneNumber" name="backupPhoneNumber"
          required>
      </div>
      <div class="col-md-6">
        <h2 class="font-14 font-weight-700">Note</h2>
        <textarea class="form-control" [(ngModel)]="passwordForm.note" name="note" rows="3" required></textarea>
      </div>
    </form>

    <div class="modal-footer justify-content-center"
      style="border-top: 1px solid #ccc; padding-top: 15px; margin-top: 15px; ">
      <button type="button" class="btn btn-outline-secondary btn-sm text-uppercase rounded-pill"
        data-bs-dismiss="offcanvas" style="margin: 10px;" (click)="resetForm()">Close</button>
      <button type="submit" class="btn btn-success btn-sm text-uppercase rounded-pill" data-bs-dismiss="offcanvas"
        (click)="submitForm()">Save changes</button>
    </div>
  </div>
</div>



<div class="modal fade" id="ExtralargeModalDelete" tabindex="-1" style="display: none;" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <h2 class="my-5 text-center"><i class="fa fa-exclamation-triangle text-danger" style="font-size: 60px;"></i>
        </h2>
        <h3 class="font-18 font-weight-700 text-center">Are you sure you want to delete this password?</h3>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-success btn-sm text-uppercase rounded-pill px-3">Yes</button>
        <button type="button" class="btn btn-outline-secondary btn-sm text-uppercase rounded-pill px-3"
          data-bs-dismiss="modal">No</button>

      </div>
    </div>
  </div>
</div>